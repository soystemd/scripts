#!/bin/sh

[ -z "$1" ] && exit 1

static=static-$1
link=$1
volatile="/run/user/1000/ccls-$1-$USER"

IFS=
set -efu

cd ~/.cache/ccls-cache-log

if [ ! -r $volatile ]; then
	mkdir -m755 $volatile
fi

if [ "$(readlink $link)" != "$volatile" ]; then
	mv $link $static
	ln -s $volatile $link
fi

if [ -e $link/.unpacked ]; then
	rsync -av --delete --exclude .unpacked ./$link/ ./$static/
else
	rsync -av ./$static/ ./$link/
	touch $link/.unpacked
fi

echo "ffsync finished syncing ccls cache."
